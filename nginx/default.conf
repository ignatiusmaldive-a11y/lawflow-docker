server {
    listen 80;
    server_name localhost;

    # Frontend
    location / {
        proxy_pass http://frontend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Backend API
    location /api/ {
        # Rewrite /api/(.*) to /$1 before passing to backend
        # Depending on how the backend is structured. 
        # Looking at frontend/src/lib/api.ts: const API_BASE = ... ?? "/api";
        # If the backend expects requests at /projects, then we need to rewrite.
        # If the backend is mounted at /api (via APIRouter prefix), then we don't.
        
        # Let's check backend/app/main.py.
        # If I cannot check it now, I will assume a rewrite is likely needed OR 
        # I will configure the proxy to pass it as is and fix the backend to have a root prefix if needed.
        
        # Usually, if I use proxy_pass http://backend:8000/; (with trailing slash), 
        # nginx strips the location prefix.
        
        proxy_pass http://backend:8000/; 
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
